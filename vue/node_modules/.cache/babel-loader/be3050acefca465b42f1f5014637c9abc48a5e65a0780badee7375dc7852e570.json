{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nexport default {\n  name: \"Manager\",\n  data() {\n    return {\n      user: JSON.parse(localStorage.getItem(\"xm-user\") || \"{}\"),\n      shopStatus: null // 店铺状态（0/1）\n    };\n  },\n\n  created() {\n    if (!this.user.id) {\n      this.$router.push(\"/login\");\n    } else {\n      this.getShopStatus(); // 获取店铺状态\n      this.initWebSocket(); // 初始化 WebSocket\n    }\n  },\n\n  computed: {\n    // 动态计算图片路径\n    shopImage() {\n      return this.shopStatus ? require(\"D:\\\\VMware\\\\koala\\\\code\\\\takeaway\\\\vue\\\\src\\\\assets\\\\imgs\\\\shopOpen.png\") // 店铺开启图片\n      : require(\"D:\\\\VMware\\\\koala\\\\code\\\\takeaway\\\\vue\\\\src\\\\assets\\\\imgs\\\\shopClose.png\"); // 店铺关闭图片\n    }\n  },\n\n  methods: {\n    initWebSocket() {\n      const wsUrl = `ws://localhost:9090/ws/order`; // 替换为实际 WebSocket 地址\n      this.ws = new WebSocket(wsUrl);\n      this.ws.onopen = () => {\n        console.log(\"WebSocket 已连接\");\n      };\n      this.ws.onmessage = event => {\n        const orderData = JSON.parse(event.data); // 解析 JSON 数据\n        console.log(\"收到新订单消息:\", orderData);\n        // 当前商家 ID\n        const userData = localStorage.getItem('xm-user');\n        const userObject = JSON.parse(userData);\n        const userId = userObject.id;\n        console.log(\"当前商家ID:\", userId);\n        console.log(orderData.businessId);\n        if (orderData.businessId === userId && userObject.role === \"BUSINESS\") {\n          // 假设消息是通知商家新订单支付完成\n          this.newOrder = \"你有新的订单，请及时处理\"; // 将消息保存到组件数据中显示\n          this.$notify({\n            title: \"新订单提醒\",\n            message: \"你有新的订单，请及时处理\",\n            type: \"success\"\n          });\n          this.playAudio();\n        }\n      };\n      this.ws.onerror = error => {\n        console.error(\"WebSocket 错误:\", error);\n      };\n      this.ws.onclose = () => {\n        console.log(\"WebSocket 已关闭\");\n      };\n    },\n    playAudio() {\n      const audio = new Audio(\"https://oss-jlx.oss-cn-beijing.aliyuncs.com/%E6%96%B0%E7%9A%84%E8%AE%A2%E5%8D%95%E6%9F%A5%E6%94%B6_%E8%80%B3%E8%81%86%E7%BD%91_%5B%E5%A3%B0%E9%9F%B3ID%EF%BC%9A35825%5D.mp3\"); // 替换为实际音频文件地址\n      audio.play().catch(error => console.error(\"音频播放错误:\", error));\n    },\n    async getShopStatus() {\n      try {\n        const username = this.user.username; // 从localStorage获取的用户名\n        const response = await this.$request.post(\"/shop/getStatus\", {\n          username\n        }); // 传递username到后端\n        this.shopStatus = response.data; // 获取店铺状态\n      } catch (error) {\n        console.error(\"获取店铺状态失败:\", error);\n      }\n    },\n    async updateShopStatus(newStatus) {\n      try {\n        const username = this.user.username; // 从localStorage获取的用户名\n        const status = newStatus ? 1 : 0; // 将布尔值转换为整数\n        const response = await this.$request.put(\"/shop/setStatus\", {\n          username,\n          status\n        }); // 传递username和status到后端\n        if (response.success) {\n          this.shopStatus = status; // 更新状态\n        }\n      } catch (error) {\n        console.error(\"更新店铺状态失败:\", error);\n      }\n    },\n    updateUser() {\n      this.user = JSON.parse(localStorage.getItem(\"xm-user\") || \"{}\"); // 更新用户信息\n    },\n\n    goToPerson() {\n      if (this.user.role === \"ADMIN\") {\n        this.$router.push(\"/adminPerson\");\n      } else if (this.user.role === \"BUSINESS\") {\n        this.$router.push(\"/businessPerson\");\n      }\n    },\n    logout() {\n      localStorage.removeItem(\"xm-user\");\n      this.$router.push(\"/login\");\n    }\n  }\n};","map":{"version":3,"names":["name","data","user","JSON","parse","localStorage","getItem","shopStatus","created","id","$router","push","getShopStatus","initWebSocket","computed","shopImage","require","methods","wsUrl","ws","WebSocket","onopen","console","log","onmessage","event","orderData","userData","userObject","userId","businessId","role","newOrder","$notify","title","message","type","playAudio","onerror","error","onclose","audio","Audio","play","catch","username","response","$request","post","updateShopStatus","newStatus","status","put","success","updateUser","goToPerson","logout","removeItem"],"sources":["src/views/Manager.vue"],"sourcesContent":["<template>\r\n  <div class=\"manager-container\">\r\n    <!-- 头部 -->\r\n    <div class=\"manager-header\">\r\n      <div class=\"manager-header-left\">\r\n        <img src=\"@/assets/imgs/logo.png\" />\r\n        <div class=\"title\">考拉外卖后台管理</div>\r\n      </div>\r\n\r\n      <div class=\"manager-header-center\">\r\n        <el-breadcrumb separator-class=\"el-icon-arrow-right\">\r\n          <el-breadcrumb-item :to=\"{ path: '/' }\">首页</el-breadcrumb-item>\r\n          <el-breadcrumb-item :to=\"{ path: $route.path }\">{{ $route.meta.name }}</el-breadcrumb-item>\r\n        </el-breadcrumb>\r\n      </div>\r\n\r\n      <div class=\"manager-header-right\">\r\n        <!-- 店铺状态 -->\r\n <div class=\"shop-status-container\" v-if=\"user.role === 'BUSINESS'\">\r\n    <!-- 店铺状态切换 -->\r\n    <div class=\"status-switch\">\r\n      <span>店铺状态:</span>\r\n      <el-switch\r\n        v-model=\"shopStatus\"\r\n        active-color=\"#13ce66\"\r\n        inactive-color=\"#ff4949\"\r\n        @change=\"updateShopStatus\"\r\n      ></el-switch>\r\n    </div>\r\n    <!-- 动态图片展示 -->\r\n    <div class=\"shop-image\">\r\n      <img :src=\"shopImage\" alt=\"店铺状态\" />\r\n    </div>\r\n  </div>\r\n\r\n        <el-dropdown placement=\"bottom\">\r\n          <div class=\"avatar\">\r\n            <img :src=\"user.avatar || 'https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png'\" />\r\n            <div>{{ user.name || '' }}</div>\r\n          </div>\r\n          <el-dropdown-menu slot=\"dropdown\">\r\n            <el-dropdown-item @click.native=\"goToPerson\">个人信息</el-dropdown-item>\r\n            <el-dropdown-item @click.native=\"$router.push('/password')\">修改密码</el-dropdown-item>\r\n            <el-dropdown-item @click.native=\"logout\">退出登录</el-dropdown-item>\r\n          </el-dropdown-menu>\r\n        </el-dropdown>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- 主体 -->\r\n    <div class=\"manager-main\">\r\n      <!-- 侧边栏 -->\r\n      <div class=\"manager-main-left\">\r\n        <el-menu :default-openeds=\"['info', 'user']\" router style=\"border: none\" :default-active=\"$route.path\">\r\n          <el-menu-item index=\"/home\">\r\n            <i class=\"el-icon-s-home\"></i>\r\n            <span slot=\"title\">系统首页</span>\r\n          </el-menu-item>\r\n          <el-submenu index=\"info\">\r\n            <template slot=\"title\">\r\n              <i class=\"el-icon-menu\"></i><span>信息管理</span>\r\n            </template>\r\n            <el-menu-item index=\"/category\">商品分类信息</el-menu-item>\r\n            <el-menu-item index=\"/goods\">商品信息</el-menu-item>\r\n            <el-menu-item index=\"/orders\">订单管理信息</el-menu-item>\r\n            <el-menu-item index=\"/collect\">店铺收藏信息</el-menu-item>\r\n            <el-menu-item index=\"/comment\">店铺评论信息</el-menu-item>\r\n            <el-menu-item index=\"/banner\" v-if=\"user.role === 'ADMIN'\">广告信息</el-menu-item>\r\n            <el-menu-item index=\"/notice\" v-if=\"user.role === 'ADMIN'\">公告信息</el-menu-item>\r\n          </el-submenu>\r\n\r\n          <el-submenu index=\"user\" v-if=\"user.role === 'ADMIN'\">\r\n            <template slot=\"title\">\r\n              <i class=\"el-icon-menu\"></i><span>用户管理</span>\r\n            </template>\r\n            <el-menu-item index=\"/admin\">管理员信息</el-menu-item>\r\n            <el-menu-item index=\"/business\">商家信息</el-menu-item>\r\n            <el-menu-item index=\"/user\">用户信息</el-menu-item>\r\n          </el-submenu>\r\n        </el-menu>\r\n      </div>\r\n\r\n      <!-- 数据表格 -->\r\n      <div class=\"manager-main-right\">\r\n        <router-view @update:user=\"updateUser\" />\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: \"Manager\",\r\n  data() {\r\n    return {\r\n      user: JSON.parse(localStorage.getItem(\"xm-user\") || \"{}\"),\r\n      shopStatus: null, // 店铺状态（0/1）\r\n    };\r\n  },\r\n  created() {\r\n    if (!this.user.id) {\r\n      this.$router.push(\"/login\");\r\n    } else {\r\n      this.getShopStatus(); // 获取店铺状态\r\n      this.initWebSocket(); // 初始化 WebSocket\r\n    }\r\n  },\r\n  computed: {\r\n    // 动态计算图片路径\r\n    shopImage() {\r\n      return this.shopStatus\r\n        ? require(\"D:\\\\VMware\\\\koala\\\\code\\\\takeaway\\\\vue\\\\src\\\\assets\\\\imgs\\\\shopOpen.png\") // 店铺开启图片\r\n        : require(\"D:\\\\VMware\\\\koala\\\\code\\\\takeaway\\\\vue\\\\src\\\\assets\\\\imgs\\\\shopClose.png\"); // 店铺关闭图片\r\n    },\r\n  },\r\n  methods: {\r\n    initWebSocket() {\r\n      const wsUrl = `ws://localhost:9090/ws/order`; // 替换为实际 WebSocket 地址\r\n      this.ws = new WebSocket(wsUrl);\r\n\r\n      this.ws.onopen = () => {\r\n        console.log(\"WebSocket 已连接\");\r\n      };\r\n      this.ws.onmessage = (event) => {\r\n        const orderData = JSON.parse(event.data); // 解析 JSON 数据\r\n        console.log(\"收到新订单消息:\", orderData)\r\n        // 当前商家 ID\r\n        const userData = localStorage.getItem('xm-user');\r\n        const userObject = JSON.parse(userData);\r\n        const userId = userObject.id;\r\n\r\n        console.log(\"当前商家ID:\",userId)\r\n        console.log(orderData.businessId)\r\n        if (orderData.businessId === userId&&userObject.role===\"BUSINESS\"){\r\n          // 假设消息是通知商家新订单支付完成\r\n          this.newOrder = \"你有新的订单，请及时处理\"; // 将消息保存到组件数据中显示\r\n          this.$notify({\r\n            title: \"新订单提醒\",\r\n            message: \"你有新的订单，请及时处理\",\r\n            type: \"success\",\r\n          });\r\n          this.playAudio();\r\n        }\r\n      };\r\n\r\n      this.ws.onerror = (error) => {\r\n        console.error(\"WebSocket 错误:\", error);\r\n      };\r\n\r\n      this.ws.onclose = () => {\r\n        console.log(\"WebSocket 已关闭\");\r\n      };\r\n    },\r\n\r\n    playAudio() {\r\n      const audio = new Audio(\"https://oss-jlx.oss-cn-beijing.aliyuncs.com/%E6%96%B0%E7%9A%84%E8%AE%A2%E5%8D%95%E6%9F%A5%E6%94%B6_%E8%80%B3%E8%81%86%E7%BD%91_%5B%E5%A3%B0%E9%9F%B3ID%EF%BC%9A35825%5D.mp3\"); // 替换为实际音频文件地址\r\n      audio.play().catch((error) => console.error(\"音频播放错误:\", error));\r\n    },\r\n    async getShopStatus() {\r\n      try {\r\n        const username = this.user.username; // 从localStorage获取的用户名\r\n        const response = await this.$request.post(\"/shop/getStatus\", { username }); // 传递username到后端\r\n        this.shopStatus = response.data; // 获取店铺状态\r\n      } catch (error) {\r\n        console.error(\"获取店铺状态失败:\", error);\r\n      }\r\n    },\r\n    async updateShopStatus(newStatus) {\r\n      try {\r\n        const username = this.user.username; // 从localStorage获取的用户名\r\n        const status = newStatus ? 1 : 0; // 将布尔值转换为整数\r\n        const response = await this.$request.put(\"/shop/setStatus\", { username, status }); // 传递username和status到后端\r\n        if (response.success) {\r\n          this.shopStatus = status; // 更新状态\r\n        }\r\n      } catch (error) {\r\n        console.error(\"更新店铺状态失败:\", error);\r\n      }\r\n    },\r\n    updateUser() {\r\n      this.user = JSON.parse(localStorage.getItem(\"xm-user\") || \"{}\"); // 更新用户信息\r\n    },\r\n    goToPerson() {\r\n      if (this.user.role === \"ADMIN\") {\r\n        this.$router.push(\"/adminPerson\");\r\n      } else if (this.user.role === \"BUSINESS\") {\r\n        this.$router.push(\"/businessPerson\");\r\n      }\r\n    },\r\n    logout() {\r\n      localStorage.removeItem(\"xm-user\");\r\n      this.$router.push(\"/login\");\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n@import \"@/assets/css/manager.css\";\r\n\r\n/* 横向布局样式 */\r\n.shop-status-container {\r\n  display: flex;\r\n  align-items: center; /* 垂直居中 */\r\n}\r\n\r\n.status-switch {\r\n  display: flex; /* 使用 Flexbox 实现水平排列 */\r\n  align-items: center; /* 垂直居中 */\r\n  gap: 10px; /* 设置间隔 */\r\n}\r\n\r\n.shop-image img {\r\n  width: 40px; /* 调整图片大小 */\r\n  height: 40px;\r\n}\r\n\r\n.shop-image img {\r\n  width: 24px;\r\n  height: 24px;\r\n  margin-left: 10px;\r\n  vertical-align: middle;\r\n}\r\n</style>\r\n"],"mappings":";AA2FA;EACAA,IAAA;EACAC,KAAA;IACA;MACAC,IAAA,EAAAC,IAAA,CAAAC,KAAA,CAAAC,YAAA,CAAAC,OAAA;MACAC,UAAA;IACA;EACA;;EACAC,QAAA;IACA,UAAAN,IAAA,CAAAO,EAAA;MACA,KAAAC,OAAA,CAAAC,IAAA;IACA;MACA,KAAAC,aAAA;MACA,KAAAC,aAAA;IACA;EACA;;EACAC,QAAA;IACA;IACAC,UAAA;MACA,YAAAR,UAAA,GACAS,OAAA;MAAA,EACAA,OAAA;IACA;EACA;;EACAC,OAAA;IACAJ,cAAA;MACA,MAAAK,KAAA;MACA,KAAAC,EAAA,OAAAC,SAAA,CAAAF,KAAA;MAEA,KAAAC,EAAA,CAAAE,MAAA;QACAC,OAAA,CAAAC,GAAA;MACA;MACA,KAAAJ,EAAA,CAAAK,SAAA,GAAAC,KAAA;QACA,MAAAC,SAAA,GAAAvB,IAAA,CAAAC,KAAA,CAAAqB,KAAA,CAAAxB,IAAA;QACAqB,OAAA,CAAAC,GAAA,aAAAG,SAAA;QACA;QACA,MAAAC,QAAA,GAAAtB,YAAA,CAAAC,OAAA;QACA,MAAAsB,UAAA,GAAAzB,IAAA,CAAAC,KAAA,CAAAuB,QAAA;QACA,MAAAE,MAAA,GAAAD,UAAA,CAAAnB,EAAA;QAEAa,OAAA,CAAAC,GAAA,YAAAM,MAAA;QACAP,OAAA,CAAAC,GAAA,CAAAG,SAAA,CAAAI,UAAA;QACA,IAAAJ,SAAA,CAAAI,UAAA,KAAAD,MAAA,IAAAD,UAAA,CAAAG,IAAA;UACA;UACA,KAAAC,QAAA;UACA,KAAAC,OAAA;YACAC,KAAA;YACAC,OAAA;YACAC,IAAA;UACA;UACA,KAAAC,SAAA;QACA;MACA;MAEA,KAAAlB,EAAA,CAAAmB,OAAA,GAAAC,KAAA;QACAjB,OAAA,CAAAiB,KAAA,kBAAAA,KAAA;MACA;MAEA,KAAApB,EAAA,CAAAqB,OAAA;QACAlB,OAAA,CAAAC,GAAA;MACA;IACA;IAEAc,UAAA;MACA,MAAAI,KAAA,OAAAC,KAAA;MACAD,KAAA,CAAAE,IAAA,GAAAC,KAAA,CAAAL,KAAA,IAAAjB,OAAA,CAAAiB,KAAA,YAAAA,KAAA;IACA;IACA,MAAA3B,cAAA;MACA;QACA,MAAAiC,QAAA,QAAA3C,IAAA,CAAA2C,QAAA;QACA,MAAAC,QAAA,cAAAC,QAAA,CAAAC,IAAA;UAAAH;QAAA;QACA,KAAAtC,UAAA,GAAAuC,QAAA,CAAA7C,IAAA;MACA,SAAAsC,KAAA;QACAjB,OAAA,CAAAiB,KAAA,cAAAA,KAAA;MACA;IACA;IACA,MAAAU,iBAAAC,SAAA;MACA;QACA,MAAAL,QAAA,QAAA3C,IAAA,CAAA2C,QAAA;QACA,MAAAM,MAAA,GAAAD,SAAA;QACA,MAAAJ,QAAA,cAAAC,QAAA,CAAAK,GAAA;UAAAP,QAAA;UAAAM;QAAA;QACA,IAAAL,QAAA,CAAAO,OAAA;UACA,KAAA9C,UAAA,GAAA4C,MAAA;QACA;MACA,SAAAZ,KAAA;QACAjB,OAAA,CAAAiB,KAAA,cAAAA,KAAA;MACA;IACA;IACAe,WAAA;MACA,KAAApD,IAAA,GAAAC,IAAA,CAAAC,KAAA,CAAAC,YAAA,CAAAC,OAAA;IACA;;IACAiD,WAAA;MACA,SAAArD,IAAA,CAAA6B,IAAA;QACA,KAAArB,OAAA,CAAAC,IAAA;MACA,gBAAAT,IAAA,CAAA6B,IAAA;QACA,KAAArB,OAAA,CAAAC,IAAA;MACA;IACA;IACA6C,OAAA;MACAnD,YAAA,CAAAoD,UAAA;MACA,KAAA/C,OAAA,CAAAC,IAAA;IACA;EACA;AACA"},"metadata":{},"sourceType":"module","externalDependencies":[]}