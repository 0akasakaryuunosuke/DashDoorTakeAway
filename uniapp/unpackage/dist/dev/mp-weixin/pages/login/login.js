(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/login/login"],{61:function(e,n,o){"use strict";(function(e,n){var t=o(4);o(26);t(o(25));var r=t(o(62));e.__webpack_require_UNI_MP_PLUGIN__=o,n(r.default)}).call(this,o(1)["default"],o(2)["createPage"])},62:function(e,n,o){"use strict";o.r(n);var t=o(63),r=o(65);for(var i in r)["default"].indexOf(i)<0&&function(e){o.d(n,e,(function(){return r[e]}))}(i);var s,a=o(32),c=Object(a["default"])(r["default"],t["render"],t["staticRenderFns"],!1,null,null,null,!1,t["components"],s);c.options.__file="pages/login/login.vue",n["default"]=c.exports},63:function(e,n,o){"use strict";o.r(n);var t=o(64);o.d(n,"render",(function(){return t["render"]})),o.d(n,"staticRenderFns",(function(){return t["staticRenderFns"]})),o.d(n,"recyclableRender",(function(){return t["recyclableRender"]})),o.d(n,"components",(function(){return t["components"]}))},64:function(e,n,o){"use strict";var t;o.r(n),o.d(n,"render",(function(){return r})),o.d(n,"staticRenderFns",(function(){return s})),o.d(n,"recyclableRender",(function(){return i})),o.d(n,"components",(function(){return t}));try{t={uniForms:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uni-forms/components/uni-forms/uni-forms")]).then(o.bind(null,195))},uniFormsItem:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uni-forms/components/uni-forms-item/uni-forms-item")]).then(o.bind(null,211))},uniEasyinput:function(){return o.e("uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput").then(o.bind(null,218))}}}catch(a){if(-1===a.message.indexOf("Cannot find module")||-1===a.message.indexOf(".vue"))throw a;console.error(a.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var r=function(){var e=this,n=e.$createElement;e._self._c},i=!1,s=[];r._withStripped=!0},65:function(e,n,o){"use strict";o.r(n);var t=o(66),r=o.n(t);for(var i in t)["default"].indexOf(i)<0&&function(e){o.d(n,e,(function(){return t[e]}))}(i);n["default"]=r.a},66:function(e,n,o){"use strict";(function(e,t){var r=o(4);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;r(o(67));var i={data:function(){return{form:{username:"",password:"",role:"USER"},rules:{username:{rules:[{required:!0,errorMessage:"请输入账号"},{minLength:3,maxLength:10,errorMessage:"账号长度在 {minLength} 到 {maxLength} 个字符"}]},password:{rules:[{required:!0,errorMessage:"请输入密码"},{minLength:3,maxLength:10,errorMessage:"密码长度在 {minLength} 到 {maxLength} 个字符"}]}},loginCode:""}},methods:{bindblur:function(e){this.nameUser=e.target.value},onChooseAvatar:function(e){var n=e.detail;this.imagUrl=n.avatarUrl,this.saveFileLocally(this.imagUrl)},saveFileLocally:function(n){var o=this;n?t.downloadFile({url:n,success:function(n){var r=n.tempFilePath;if(r){var i=t.getFileSystemManager(),s="".concat(t.env.USER_DATA_PATH,"/").concat(Date.now(),".jpg");i.saveFile({tempFilePath:r,filePath:s,success:function(n){console.log("文件保存成功：",n.savedFilePath),e.showToast({title:"文件保存成功",duration:2e3}),o.handleSavedFile(n.savedFilePath)},fail:function(n){console.error("保存文件失败：",n),e.showToast({title:"保存失败，请重试",icon:"error"})}})}else e.showToast({title:"文件下载失败",icon:"error"})},fail:function(n){console.error("文件下载失败：",n),e.showToast({title:"下载失败，请重试",icon:"error"})}}):e.showToast({title:"文件路径无效",icon:"error"})},handleSavedFile:function(n){t.saveImageToPhotosAlbum({filePath:n,success:function(){e.showToast({title:"已保存到相册",duration:2e3})},fail:function(n){console.error("保存到相册失败：",n),e.showToast({title:"保存到相册失败",icon:"error"})}})},login:function(){var n=this;console.log("页面加载成功！"),this.$refs.form.validate().then((function(o){n.$request.post("/login",n.form).then((function(n){"200"===n.code?(e.showToast({icon:"success",title:"登录成功"}),e.setStorageSync("xm-user",n.data),e.switchTab({url:"/pages/index/index"})):e.showToast({icon:"error",title:n.msg})}))})).catch((function(e){console.log("表单错误信息：",e)}))},handleLogin:function(){var e=this;t.login({success:function(n){n.code?(console.log("微信登录成功，code:",n.code),e.loginCode=n.code,e.handleGetUserProfile()):console.error("微信登录失败：",n.errMsg)},fail:function(e){console.error("微信登录接口调用失败：",e)}})},handleGetUserProfile:function(){var n=this;e.showModal({title:"用户授权",content:"我们需要获取您的昵称和头像信息来完善您的个人资料。",success:function(e){e.confirm?n.getUserProfile():console.log("用户取消授权")}})},getUserProfile:function(){var n=this;t.getUserProfile({desc:"用于完善用户信息",success:function(o){var r=o.userInfo,i=r.avatarUrl,s=r.nickName;t.downloadFile({url:i,success:function(o){if(200===o.statusCode){var r=o.tempFilePath;t.uploadFile({url:"http://localhost:9090/upload",filePath:r,name:"file",success:function(o){var t=o.data;console.log("头像上传成功:",t),n.$request.post("/wx-login",{code:n.loginCode,avatarUrl:t.url,nickName:s}).then((function(n){"200"===n.code?(e.showToast({icon:"success",title:"微信登录成功"}),e.setStorageSync("xm-user",n.data),e.switchTab({url:"/pages/index/index"})):e.showToast({icon:"error",title:n.msg||"登录失败，请重试"})})).catch((function(n){e.showToast({icon:"error",title:n.message||"登录失败，请重试"}),console.error("微信登录失败:",n)}))},fail:function(n){console.error("头像上传失败:",n),e.showToast({icon:"error",title:"头像上传失败"})}})}},fail:function(n){console.error("头像下载失败:",n),e.showToast({icon:"error",title:"头像下载失败"})}})},fail:function(n){console.error("获取用户信息失败：",n),e.showToast({icon:"error",title:"获取用户信息失败"})}})}}};n.default=i}).call(this,o(2)["default"],o(1)["default"])}},[[61,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/login/login.js.map